// i18n.js - Internationalization (Multi-language support)

const i18n = {
    currentLang: 'cs',

    translations: {
        cs: {
            // Header
            'tournament.title': 'Losovac√≠ web',
            'tournament.subtitle': 'Spr√°va turnaj≈Ø',

            // Buttons
            'btn.share': 'QR k√≥d - Sd√≠let',
            'btn.stats': 'Statistiky nap≈ô√≠ƒç turnaji',
            'btn.theme': 'Motiv',
            'btn.darkmode': 'Tmav√Ω re≈æim',
            'btn.history': 'Historie',
            'btn.print': 'Tisk',
            'btn.export': 'Export',
            'btn.save': 'Ulo≈æit',
            'btn.cancel': 'Zru≈°it',
            'btn.next': 'Dal≈°√≠',
            'btn.back': 'Zpƒõt',
            'btn.add': 'P≈ôidat',
            'btn.edit': 'Upravit',
            'btn.delete': 'Smazat',
            'btn.start': 'Zaƒç√≠t',
            'btn.finish': 'Dokonƒçit',

            // Steps
            'step.setup': 'Nastaven√≠',
            'step.participants': '√öƒçastn√≠ci',
            'step.draw': 'Losov√°n√≠',
            'step.matches': 'Z√°pasy',
            'step.results': 'V√Ωsledky',

            // Setup
            'setup.title': 'Nastaven√≠ turnaje',
            'setup.name': 'N√°zev turnaje',
            'setup.date': 'Datum',
            'setup.system': 'Hern√≠ syst√©m',
            'setup.courts': 'Poƒçet kurt≈Ø',
            'setup.matchDuration': 'Pr≈Ømƒõrn√° d√©lka z√°pasu (min)',
            'setup.pointsWin': 'Body za v√Ωhru',
            'setup.pointsDraw': 'Body za rem√≠zu',
            'setup.bestOf': 'Best of',
            'setup.pointsPerSet': 'Body na set',

            // Systems
            'system.roundrobin': 'Ka≈æd√Ω s ka≈æd√Ωm',
            'system.swiss': '≈†v√Ωcarsk√Ω syst√©m',
            'system.groups': 'Skupiny + Playoff',
            'system.knockout': 'Vy≈ôazovac√≠',

            // Participants
            'participant.add': 'P≈ôidat √∫ƒçastn√≠ka',
            'participant.edit': 'Upravit √∫ƒçastn√≠ka',
            'participant.name': 'Jm√©no',
            'participant.partner': 'Partner',
            'participant.club': 'Klub/Mƒõsto',
            'participant.seed': 'Nasazen√≠ (1-10)',
            'participant.email': 'E-mail',
            'participant.phone': 'Telefon',
            'participant.type': 'Typ',
            'participant.single': 'Jednotlivec',
            'participant.double': 'Debl (dvojice)',

            // Matches
            'match.round': 'Kolo',
            'match.court': 'Kurt',
            'match.start': 'Zaƒç√≠t z√°pas',
            'match.finish': 'Dokonƒçit',
            'match.edit': 'Upravit',
            'match.notes': 'Pozn√°mky',
            'match.playing': 'Pr√°vƒõ hraje',

            // Results
            'results.standings': 'Koneƒçn√© po≈ôad√≠',
            'results.position': 'Po≈ôad√≠',
            'results.player': 'Jm√©no',
            'results.matches': 'Z√°pasy',
            'results.wins': 'V√Ωhry',
            'results.draws': 'Rem√≠zy',
            'results.losses': 'Prohry',
            'results.sets': 'Sety',
            'results.points': 'Body',

            // Notifications
            'notify.participantAdded': '√öƒçastn√≠k p≈ôid√°n',
            'notify.participantEdited': '√öƒçastn√≠k upraven',
            'notify.participantRemoved': '√öƒçastn√≠k odebr√°n',
            'notify.drawPerformed': 'Losov√°n√≠ provedeno',
            'notify.tournamentSaved': 'Turnaj ulo≈æen do historie',
            'notify.exportPDF': 'PDF se generuje...',
            'notify.exportJSON': 'JSON exportov√°n',
            'notify.exportCSV': 'CSV exportov√°n',
            'notify.linkCopied': 'Odkaz zkop√≠rov√°n',

            // Modals
            'modal.share': 'Sd√≠let turnaj',
            'modal.share.text': 'Naskenujte QR k√≥d pro zobrazen√≠ turnaje',
            'modal.stats': 'Statistiky nap≈ô√≠ƒç turnaji',
            'modal.stats.text': 'Agregovan√© statistiky ze v≈°ech {count} turnaj≈Ø v historii',
            'modal.export': 'Export dat',
            'modal.history': 'Historie turnaj≈Ø',
            'modal.theme': 'Vyberte motiv'
        },

        en: {
            // Header
            'tournament.title': 'Tournament Manager',
            'tournament.subtitle': 'Tournament Management',

            // Buttons
            'btn.share': 'QR Code - Share',
            'btn.stats': 'Statistics Across Tournaments',
            'btn.theme': 'Theme',
            'btn.darkmode': 'Dark Mode',
            'btn.history': 'History',
            'btn.print': 'Print',
            'btn.export': 'Export',
            'btn.save': 'Save',
            'btn.cancel': 'Cancel',
            'btn.next': 'Next',
            'btn.back': 'Back',
            'btn.add': 'Add',
            'btn.edit': 'Edit',
            'btn.delete': 'Delete',
            'btn.start': 'Start',
            'btn.finish': 'Finish',

            // Steps
            'step.setup': 'Setup',
            'step.participants': 'Participants',
            'step.draw': 'Draw',
            'step.matches': 'Matches',
            'step.results': 'Results',

            // Setup
            'setup.title': 'Tournament Setup',
            'setup.name': 'Tournament Name',
            'setup.date': 'Date',
            'setup.system': 'Game System',
            'setup.courts': 'Number of Courts',
            'setup.matchDuration': 'Average Match Duration (min)',
            'setup.pointsWin': 'Points for Win',
            'setup.pointsDraw': 'Points for Draw',
            'setup.bestOf': 'Best of',
            'setup.pointsPerSet': 'Points per Set',

            // Systems
            'system.roundrobin': 'Round Robin',
            'system.swiss': 'Swiss System',
            'system.groups': 'Groups + Playoff',
            'system.knockout': 'Knockout',

            // Participants
            'participant.add': 'Add Participant',
            'participant.edit': 'Edit Participant',
            'participant.name': 'Name',
            'participant.partner': 'Partner',
            'participant.club': 'Club/City',
            'participant.seed': 'Seeding (1-10)',
            'participant.email': 'E-mail',
            'participant.phone': 'Phone',
            'participant.type': 'Type',
            'participant.single': 'Singles',
            'participant.double': 'Doubles',

            // Matches
            'match.round': 'Round',
            'match.court': 'Court',
            'match.start': 'Start Match',
            'match.finish': 'Finish',
            'match.edit': 'Edit',
            'match.notes': 'Notes',
            'match.playing': 'Playing Now',

            // Results
            'results.standings': 'Final Standings',
            'results.position': 'Position',
            'results.player': 'Name',
            'results.matches': 'Matches',
            'results.wins': 'Wins',
            'results.draws': 'Draws',
            'results.losses': 'Losses',
            'results.sets': 'Sets',
            'results.points': 'Points',

            // Notifications
            'notify.participantAdded': 'Participant added',
            'notify.participantEdited': 'Participant edited',
            'notify.participantRemoved': 'Participant removed',
            'notify.drawPerformed': 'Draw performed',
            'notify.tournamentSaved': 'Tournament saved to history',
            'notify.exportPDF': 'Generating PDF...',
            'notify.exportJSON': 'JSON exported',
            'notify.exportCSV': 'CSV exported',
            'notify.linkCopied': 'Link copied',

            // Modals
            'modal.share': 'Share Tournament',
            'modal.share.text': 'Scan QR code to view tournament',
            'modal.stats': 'Statistics Across Tournaments',
            'modal.stats.text': 'Aggregated statistics from all {count} tournaments in history',
            'modal.export': 'Export Data',
            'modal.history': 'Tournament History',
            'modal.theme': 'Select Theme'
        }
    },

    // Initialize language from localStorage
    init() {
        const saved = localStorage.getItem('language');
        if (saved && this.translations[saved]) {
            this.currentLang = saved;
        }
        this.updateHTMLLang();
    },

    // Get translation
    t(key, replacements = {}) {
        let text = this.translations[this.currentLang][key] || key;

        // Replace placeholders like {count}
        Object.keys(replacements).forEach(placeholder => {
            text = text.replace(`{${placeholder}}`, replacements[placeholder]);
        });

        return text;
    },

    // Switch language
    setLanguage(lang) {
        if (this.translations[lang]) {
            this.currentLang = lang;
            localStorage.setItem('language', lang);
            this.updateHTMLLang();
            // Trigger re-render if UI object exists
            if (typeof UI !== 'undefined' && UI.render) {
                UI.render();
            }
            if (typeof Utils !== 'undefined' && Utils.showNotification) {
                Utils.showNotification(lang === 'cs' ? 'Jazyk zmƒõnƒõn' : 'Language changed');
            }
        }
    },

    // Update HTML lang attribute
    updateHTMLLang() {
        document.documentElement.lang = this.currentLang;
    },

    // Language selector modal
    showLanguageSelector() {
        const modal = document.createElement('div');
        modal.className = 'modal show';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üåç ${this.currentLang === 'cs' ? 'Vyberte jazyk' : 'Select Language'}</h3>
                    <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                </div>
                <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                    <button class="btn ${this.currentLang === 'cs' ? 'btn-primary' : 'btn-outline'}"
                            onclick="i18n.setLanguage('cs'); this.closest('.modal').remove();">
                        üá®üáø ƒåe≈°tina
                    </button>
                    <button class="btn ${this.currentLang === 'en' ? 'btn-primary' : 'btn-outline'}"
                            onclick="i18n.setLanguage('en'); this.closest('.modal').remove();">
                        üá¨üáß English
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }
};

// Initialize on load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => i18n.init());
} else {
    i18n.init();
}
