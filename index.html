                }
            });
        };
        
        // Oznaƒçit z√°pas jako "Pr√°vƒõ hraje"
        window.togglePlayingNow = (matchId, groupId = null) => {
            if (groupId !== null) {
                window.tournamentData.groups = window.tournamentData.groups.map(g => {
                    if (g.id === groupId) {
                        return {
                            ...g,
                            matches: g.matches.map(m => {
                                if (m.id === matchId) {
                    const newPlayingState = !m.playingNow;
                                    if (newPlayingState) {
                                        addToHistory('match_playing', {
                                            player1: m.player1.name,
                                            player2: m.player2.name
                                        });
                                    }
                                    return { ...m, playingNow: newPlayingState };
                                }
                                return m;
                            })
                        };
                    }
                    return g;
                });
                saveData();
                renderGroups();
            } else {
                const match = window.tournamentData.matches.find(m => m.id === matchId);
                
                window.tournamentData.matches = window.tournamentData.matches.map(m => {
                    if (m.id === matchId) {
                        const newPlayingState = !m.playingNow;
                        if (newPlayingState && match) {
                            addToHistory('match_playing', {
                                player1: match.player1.name,
                                player2: match.player2.name
                            });
                        }
                        return { ...m, playingNow: newPlayingState };
                    }
                    return m;
                });
                
                saveData();
                
                if (window.tournamentData.system === 'roundrobin') {
                    renderRoundRobin();
                } else if (window.tournamentData.system === 'swiss') {
                    renderSwiss();
                }
            }
        };
        
        // √öprava kol (pouze pro round-robin)
        window.editRounds = () => {
            if (window.tournamentData.system !== 'roundrobin') return;
            
            const matches = window.tournamentData.matches;
            const rounds = [...new Set(matches.map(m => m.round))].sort();
            const participants = window.tournamentData.participants;
            
            const content = document.getElementById('editRoundsContent');
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-50 p-3 rounded text-sm text-blue-800">
                        üí° <strong>Tip:</strong> P≈ôet√°hnƒõte z√°pasy mezi koly nebo zmƒõ≈àte soupe≈ôe pomoc√≠ dropdown≈Ø.
                    </div>
                    ${rounds.map(round => {
                        const roundMatches = matches.filter(m => m.round === round);
                        return `
                            <div class="border rounded-lg p-4">
                                <h4 class="font-bold text-lg mb-3">Kolo ${round}</h4>
                                <div class="space-y-2">
                                    ${roundMatches.map(match => `
                                        <div class="flex items-center gap-2 bg-gray-50 p-2 rounded" data-match-id="${match.id}">
                                            <select class="flex-1 px-2 py-1 border rounded" onchange="updateMatchPlayer(${match.id}, 'player1', this.value)">
                                                ${participants.map(p => `
                                                    <option value="${p.id}" ${p.id === match.player1.id ? 'selected' : ''}>
                                                        ${p.name}
                                                    </option>
                                                `).join('')}
                                            </select>
                                            <span class="font-bold">vs</span>
                                            <select class="flex-1 px-2 py-1 border rounded" onchange="updateMatchPlayer(${match.id}, 'player2', this.value)">
                                                ${participants.map(p => `
                                                    <option value="${p.id}" ${p.id === match.player2.id ? 'selected' : ''}>
                                                        ${p.name}
                                                    </option>
                                                `).join('')}
                                            </select>
                                            <select class="px-2 py-1 border rounded w-24" onchange="updateMatchRound(${match.id}, this.value)">
                                                ${rounds.map(r => `
                                                    <option value="${r}" ${r === round ? 'selected' : ''}>
                                                        Kolo ${r}
                                                    </option>
                                                `).join('')}
                                            </select>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            
            document.getElementById('editRoundsModal').classList.remove('hidden');
        };
        
        window.tempMatchEdits = {};
        
        window.updateMatchPlayer = (matchId, playerSlot, playerId) => {
            if (!window.tempMatchEdits[matchId]) {
                const match = window.tournamentData.matches.find(m => m.id === matchId);
                window.tempMatchEdits[matchId] = { ...match };
            }
            
            const participant = window.tournamentData.participants.find(p => p.id == playerId);
            if (participant) {
                window.tempMatchEdits[matchId][playerSlot] = participant;
            }
        };
        
        window.updateMatchRound = (matchId, newRound) => {
            if (!window.tempMatchEdits[matchId]) {
                const match = window.tournamentData.matches.find(m => m.id === matchId);
                window.tempMatchEdits[matchId] = { ...match };
            }
            
            window.tempMatchEdits[matchId].round = parseInt(newRound);
        };
        
        window.saveRoundEdits = () => {
            // Aplikovat zmƒõny
            window.tournamentData.matches = window.tournamentData.matches.map(match => {
                if (window.tempMatchEdits[match.id]) {
                    return { ...match, ...window.tempMatchEdits[match.id] };
                }
                return match;
            });
            
            // Validace - zkontrolovat duplicity
            const seen = new Set();
            let hasDuplicates = false;
            
            window.tournamentData.matches.forEach(match => {
                const key1 = `${match.player1.id}-${match.player2.id}`;
                const key2 = `${match.player2.id}-${match.player1.id}`;
                
                if (seen.has(key1) || seen.has(key2)) {
                    hasDuplicates = true;
                }
                seen.add(key1);
                seen.add(key2);
            });
            
            if (hasDuplicates) {
                showNotification('‚ö†Ô∏è Varov√°n√≠: Nƒõkte≈ô√≠ hr√°ƒçi hraj√≠ spolu v√≠cekr√°t!', 'warning');
            }
            
            window.tempMatchEdits = {};
            addToHistory('rounds_edit', { message: 'Rozlosov√°n√≠ kol upraveno' });
            saveData();
            renderRoundRobin();
            closeEditRounds();
            showNotification('‚úÖ Zmƒõny ulo≈æeny!', 'success');
        };
        
        window.closeEditRounds = () => {
            window.tempMatchEdits = {};
            document.getElementById('editRoundsModal').classList.add('hidden');
        };
        
        // Historie zmƒõn
        window.addToHistory = (action, details) => {
            if (!window.tournamentData.history) {
                window.tournamentData.history = [];
            }
            
            const actionLabels = {
                'tournament_start': 'üöÄ Turnaj spu≈°tƒõn',
                'tournament_reset': 'üîÑ Turnaj resetov√°n',
                'score_update': '‚öΩ V√Ωsledek zad√°n',
                'score_delete': 'üóëÔ∏è V√Ωsledek smaz√°n',
                'note_add': 'üìù Pozn√°mka p≈ôid√°na',
                'note_delete': 'üóëÔ∏è Pozn√°mka smaz√°na',
                'participant_add': '‚ûï √öƒçastn√≠k p≈ôid√°n',
                'participant_remove': '‚ûñ √öƒçastn√≠k odebr√°n',
                'playoff_generate': 'üèÜ Play-off vygenerov√°no',
                'swiss_round': 'üîÑ Nov√© kolo ≈°v√Ωcaru',
                'tournament_duplicate': 'üìã Turnaj duplikov√°n',
                'data_import': 'üì§ Data importov√°na',
                'data_export': 'üì• Data exportov√°na',
                'match_playing': 'üè∏ Z√°pas pr√°vƒõ hraje'
            };
            
            window.tournamentData.history.push({
                timestamp: new Date().toISOString(),
                action: action,
                label: actionLabels[action] || action,
                details: details
            });
            
            // Omezit historii na posledn√≠ch 100 z√°znam≈Ø
            if (window.tournamentData.history.length > 100) {
                window.tournamentData.history = window.tournamentData.history.slice(-100);
            }
            
            saveData();
        };
        
        window.showHistory = () => {
            const history = window.tournamentData.history || [];
            const content = document.getElementById('historyContent');
            
            if (history.length === 0) {
                content.innerHTML = '<p class="text-gray-500 text-center py-8">Zat√≠m ≈æ√°dn√° historie</p>';
            } else {
                // Se≈ôadit od nejnovƒõj≈°√≠ch
                const sortedHistory = [...history].reverse();
                
                content.innerHTML = `
                    <div class="space-y-2">
                        ${sortedHistory.map((entry, index) => {
                            const date = new Date(entry.timestamp);
                            const timeStr = date.toLocaleString('cs-CZ', {
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            return `
                                <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-blue-500">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="font-semibold text-gray-800">${entry.label}</div>
                                            ${entry.details ? `
                                                <div class="text-sm text-gray-600 mt-1">
                                                    ${formatHistoryDetails(entry.details)}
                                                </div>
                                            ` : ''}
                                        </div>
                                        <div class="text-xs text-gray-500 ml-2 whitespace-nowrap">
                                            ${timeStr}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    ${history.length > 50 ? `
                        <div class="text-center text-sm text-gray-500 mt-4">
                            Zobrazeno posledn√≠ch 100 z√°znam≈Ø
                        </div>
                    ` : ''}
                `;
            }
            
            document.getElementById('historyModal').classList.remove('hidden');
        };
        
        window.formatHistoryDetails = (details) => {
            if (typeof details === 'string') return details;
            if (!details) return '';
            
            const parts = [];
            if (details.player1 && details.player2) {
                parts.push(`${details.player1} vs ${details.player2}`);
            }
            if (details.score) parts.push(`Sk√≥re: ${details.score}`);
            if (details.oldScore && details.newScore) {
                parts.push(`${details.oldScore} ‚Üí ${details.newScore}`);
            }
            if (details.name) parts.push(details.name);
            if (details.numGroups) parts.push(`${details.numGroups} skupin`);
            if (details.round) parts.push(`Kolo ${details.round}`);
            if (details.note) parts.push(`"${details.note}"`);
            
            return parts.join(' ‚Ä¢ ');
        };
        
        window.closeHistory = () => {
            document.getElementById('historyModal').classList.add('hidden');
        };
        
        // Dark mode
        window.toggleDarkMode = () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
        };
        
        // Notifikace
        window.showNotification = (message, type = 'success') => {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'bg-red-500' : 'bg-green-500'} text-white`;
            notification.textContent = message;
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        };
        
        // Notifikace
        window.showNotification = (message, type = 'success') => {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            const bgColor = type === 'error' ? 'bg-red-500' : type === 'warning' ? 'bg-orange-500' : 'bg-green-500';
            notification.className = `notification ${bgColor} text-white`;
            notification.textContent = message;
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        };
        
        // QR k√≥d/URL sd√≠len√≠
        window.showQRCode = () => {
            const data = JSON.stringify(window.tournamentData);
            const compressed = btoa(encodeURIComponent(data));
            const baseUrl = window.location.href.split('?')[0];
            const shareUrl = `${baseUrl}?data=${compressed}`;
            
            const container = document.getElementById('qrCodeContainer');
            
            // Kontrola d√©lky URL
            const urlLength = shareUrl.length;
            const isTooLong = urlLength > 2000;
            
            container.innerHTML = `
                <div class="bg-gray-100 p-6 rounded-lg">
                    ${isTooLong ? `
                        <div class="bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded mb-4">
                            ‚ö†Ô∏è URL je p≈ô√≠li≈° dlouh√© (${urlLength} znak≈Ø). Doporuƒçujeme pou≈æ√≠t Export/Import JSON m√≠sto URL.
                        </div>
                    ` : `
                        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                            ‚úÖ URL p≈ôipraveno ke sd√≠len√≠ (${urlLength} znak≈Ø)
                        </div>
                    `}
                    
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Odkaz pro sd√≠len√≠:</label>
                        <div class="flex gap-2">
                            <input type="text" id="shareUrlInput" value="${shareUrl}" readonly
                                class="flex-1 px-3 py-2 border rounded text-sm bg-white"
                                onclick="this.select()">
                            <button onclick="copyShareUrl()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold whitespace-nowrap">
                                üìã Zkop√≠rovat
                            </button>
                        </div>
                    </div>
                    
                    <div class="text-sm text-gray-600 space-y-2">
                        <p><strong>Jak sd√≠let:</strong></p>
                        <ol class="list-decimal ml-5 space-y-1">
                            <li>Zkop√≠rujte odkaz tlaƒç√≠tkem v√Ω≈°e</li>
                            <li>Po≈°lete odkaz koleg≈Øm (email, WhatsApp...)</li>
                            <li>P≈ôi otev≈ôen√≠ odkazu se automaticky naƒçte turnaj</li>
                        </ol>
                        
                        <p class="mt-3"><strong>üí° Tip:</strong> Pro dlouhodob√© ukl√°d√°n√≠ pou≈æijte Export/Import JSON souboru.</p>
                    </div>
                </div>
            `;
            
            document.getElementById('qrModal').classList.remove('hidden');
        };
        
        window.copyShareUrl = () => {
            const input = document.getElementById('shareUrlInput');
            input.select();
            navigator.clipboard.writeText(input.value).then(() => {
                showNotification('‚úÖ Odkaz zkop√≠rov√°n do schr√°nky!', 'success');
            }).catch(() => {
                showNotification('‚ùå Chyba p≈ôi kop√≠rov√°n√≠', 'error');
            });
        };
        
        window.closeQR = () => {
            document.getElementById('qrModal').classList.add('hidden');
        };
        
        // Naƒç√≠st data z URL p≈ôi startu
        const urlParams = new URLSearchParams(window.location.search);
        const dataParam = urlParams.get('data');
        
        if (dataParam) {
            try {
                const decodedData = decodeURIComponent(atob(dataParam));
                const data = JSON.parse(decodedData);
                Object.assign(window.tournamentData, data);
                saveData();
                
                // Odstranit parametr z URL pro ƒçistotu
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // Zobrazit spr√°vnou sekci
                if (data.step === 'matches') {
                    setTimeout(() => {
                        document.getElementById('setupSection').classList.add('hidden');
                        document.getElementById('matchesSection').classList.remove('hidden');
                        document.getElementById('tournamentTitle').textContent = data.name;
                        
                        if (data.system === 'roundrobin') {
                            renderRoundRobin();
                        } else if (data.system === 'groups') {
                            renderGroups();
                        } else if (data.system === 'swiss') {
                            renderSwiss();
                        }
                        
                        showNotification('‚úÖ Turnaj naƒçten z odkazu!', 'success');
                    }, 100);
                } else if (data.step === 'playoff') {
                    setTimeout(() => {
                        document.getElementById('setupSection').classList.add('hidden');
                        document.getElementById('playoffSection').classList.remove('hidden');
                        renderPlayoff();
                        showNotification('‚úÖ Play-off naƒçteno z odkazu!', 'success');
                    }, 100);
                } else {
                    setTimeout(() => {
                        renderParticipants();
                        document.getElementById('tournamentName').value = data.name;
                        showNotification('‚úÖ Nastaven√≠ naƒçteno z odkazu!', 'success');
                    }, 100);
                }
            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat z URL:', error);
                showNotification('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat z odkazu', 'error');
            }
        }
        
        // Statistiky
        window.showStats = () => {
            const participants = window.tournamentData.participants;
            const system = window.tournamentData.system;
            let allMatches = [];
            
            if (system === 'groups') {
                window.tournamentData.groups.forEach(g => {
                    allMatches = allMatches.concat(g.matches);
                });
            } else {
                allMatches = window.tournamentData.matches;
            }
            
            const finishedMatches = allMatches.filter(m => m.finished);
            const totalMatches = allMatches.length;
            const progress = totalMatches > 0 ? Math.round((finishedMatches.length / totalMatches) * 100) : 0;
            
            // Pr≈Ømƒõrn√© sk√≥re
            let totalSets = 0;
            finishedMatches.forEach(m => {
                totalSets += m.score1 + m.score2;
            });
            const avgSets = finishedMatches.length > 0 ? (totalSets / finishedMatches.length).toFixed(1) : 0;
            
            // Nejvy≈°≈°√≠ sk√≥re
            let highestScore = { score1: 0, score2: 0, player1: null, player2: null };
            finishedMatches.forEach(m => {
                const total = m.score1 + m.score2;
                const highestTotal = highestScore.score1 + highestScore.score2;
                if (total > highestTotal) {
                    highestScore = m;
                }
            });
            
            // Nejdel≈°√≠ s√©rie v√Ωher
            const streaks = {};
            participants.forEach(p => {
                streaks[p.id] = { current: 0, max: 0, name: p.name };
            });
            
            finishedMatches.forEach(match => {
                if (match.score1 > match.score2) {
                    streaks[match.player1.id].current++;
                    streaks[match.player1.id].max = Math.max(streaks[match.player1.id].max, streaks[match.player1.id].current);
                    if (streaks[match.player2.id]) streaks[match.player2.id].current = 0;
                } else if (match.score2 > match.score1) {
                    streaks[match.player2.id].current++;
                    streaks[match.player2.id].max = Math.max(streaks[match.player2.id].max, streaks[match.player2.id].current);
                    if (streaks[match.player1.id]) streaks[match.player1.id].current = 0;
                }
            });
            
            const bestStreak = Object.values(streaks).reduce((best, streak) => {
                return streak.max > best.max ? streak : best;
            }, { max: 0, name: '-' });
            
            // Nejv√≠ce rem√≠z
            const draws = {};
            participants.forEach(p => {
                draws[p.id] = { count: 0, name: p.name };
            });
            
            finishedMatches.forEach(match => {
                if (match.score1 === match.score2) {
                    if (draws[match.player1.id]) draws[match.player1.id].count++;
                    if (draws[match.player2.id]) draws[match.player2.id].count++;
                }
            });
            
            const mostDraws = Object.values(draws).reduce((most, d) => {
                return d.count > most.count ? d : most;
            }, { count: 0, name: '-' });
            
            // Nejproduktivnƒõj≈°√≠ hr√°ƒç (nejv√≠c set≈Ø celkem)
            const totalSetsPerPlayer = {};
            participants.forEach(p => {
                totalSetsPerPlayer[p.id] = { total: 0, name: p.name };
            });
            
            finishedMatches.forEach(match => {
                if (totalSetsPerPlayer[match.player1.id]) totalSetsPerPlayer[match.player1.id].total += match.score1;
                if (totalSetsPerPlayer[match.player2.id]) totalSetsPerPlayer[match.player2.id].total += match.score2;
            });
            
            const mostProductive = Object.values(totalSetsPerPlayer).reduce((most, p) => {
                return p.total > most.total ? p : most;
            }, { total: 0, name: '-' });
            
            // Pozn√°mky
            const matchesWithNotes = allMatches.filter(m => m.note && m.note.trim());
            
            const content = document.getElementById('statsContent');
            content.innerHTML = `
                <div class="space-y-4">
                    <h4 class="font-bold text-lg mb-3">üìà Celkov√© statistiky</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">Dokonƒçeno z√°pas≈Ø</div>
                            <div class="text-2xl font-bold">${finishedMatches.length} / ${totalMatches}</div>
                            <div class="text-sm text-blue-600">${progress}%</div>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">Pr≈Ømƒõrn√© sk√≥re z√°pasu</div>
                            <div class="text-2xl font-bold">${avgSets}</div>
                            <div class="text-sm text-green-600">set≈Ø celkem</div>
                        </div>
                        
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">Nejdel≈°√≠ s√©rie v√Ωher</div>
                            <div class="text-2xl font-bold">${bestStreak.max} üî•</div>
                            <div class="text-sm text-purple-600">${bestStreak.name}</div>
                        </div>
                        
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">Celkem √∫ƒçastn√≠k≈Ø</div>
                            <div class="text-2xl font-bold">${participants.length}</div>
                        </div>
                    </div>
                    
                    ${highestScore.player1 ? `
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 mb-2">üéØ Nejvy≈°≈°√≠ sk√≥re z√°pasu</div>
                            <div class="font-bold">${highestScore.player1.name} ${highestScore.score1}:${highestScore.score2} ${highestScore.player2.name}</div>
                            <div class="text-sm text-gray-600">Celkem ${highestScore.score1 + highestScore.score2} set≈Ø</div>
                        </div>
                    ` : ''}
                    
                    ${mostDraws.count > 0 ? `
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">‚öñÔ∏è Nejv√≠ce rem√≠z</div>
                            <div class="text-xl font-bold">${mostDraws.count}x</div>
                            <div class="text-sm text-gray-600">${mostDraws.name}</div>
                        </div>
                    ` : ''}
                    
                    ${mostProductive.total > 0 ? `
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">‚ö° Nejproduktivnƒõj≈°√≠ hr√°ƒç</div>
                            <div class="text-xl font-bold">${mostProductive.total} set≈Ø</div>
                            <div class="text-sm text-indigo-600">${mostProductive.name}</div>
                        </div>
                    ` : ''}
                    
                    ${matchesWithNotes.length > 0 ? `
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">üìù Z√°pasy s pozn√°mkami</div>
                            <div class="text-xl font-bold">${matchesWithNotes.length}</div>
                            <div class="text-xs text-gray-600 mt-2 max-h-32 overflow-y-auto">
                                ${matchesWithNotes.slice(0, 5).map(m => `
                                    <div class="mb-1">‚Ä¢ ${m.player1.name} vs ${m.player2.name}: ${m.note}</div>
                                `).join('')}
                                ${matchesWithNotes.length > 5 ? `<div class="text-gray-500">... a ${matchesWithNotes.length - 5} dal≈°√≠ch</div>` : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('statsModal').classList.remove('hidden');
        };
        window.showSearch = () => {
            document.getElementById('searchModal').classList.remove('hidden');
            document.getElementById('searchInput').focus();
        };
        
        window.closeSearch = () => {
            document.getElementById('searchModal').classList.add('hidden');
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
        };
        
        window.performSearch = () => {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (!query) {
                results.innerHTML = '';
                return;
            }
            
            const system = window.tournamentData.system;
            let allMatches = [];
            
            if (system === 'groups') {
                window.tournamentData.groups.forEach(group => {
                    group.matches.forEach(match => {
                        if (match.player1.name.toLowerCase().includes(query) || 
                            match.player2.name.toLowerCase().includes(query)) {
                            allMatches.push({...match, groupName: group.name});
                        }
                    });
                });
            } else {
                allMatches = window.tournamentData.matches.filter(match => 
                    match.player1.name.toLowerCase().includes(query) || 
                    match.player2.name.toLowerCase().includes(query)
                );
            }
            
            if (allMatches.length === 0) {
                results.innerHTML = '<p class="text-gray-500 text-center py-4">≈Ω√°dn√© v√Ωsledky</p>';
                return;
            }
            
            results.innerHTML = allMatches.map(match => `
                <div class="bg-gray-50 p-3 rounded-lg mb-2">
                    ${match.groupName ? `<div class="text-xs text-gray-500 mb-1">${match.groupName}</div>` : ''}
                    <div class="flex items-center justify-between">
                        <span class="font-medium">${match.player1.name}</span>
                        <span class="font-bold">${match.finished ? `${match.score1}:${match.score2}` : 'vs'}</span>
                        <span class="font-medium">${match.player2.name}</span>
                    </div>
                </div>
            `).join('');
        };
        
        // Statistiky
        window.showStats = () => {
            const participants = window.tournamentData.participants;
            const system = window.tournamentData.system;
            let allMatches = [];
            
            if (system === 'groups') {
                window.tournamentData.groups.forEach(g => {
                    allMatches = allMatches.concat(g.matches);
                });
            } else {
                allMatches = window.tournamentData.matches;
            }
            
            const finishedMatches = allMatches.filter(m => m.finished);
            const totalMatches = allMatches.length;
            const progress = totalMatches > 0 ? Math.round((finishedMatches.length / totalMatches) * 100) : 0;
            
            // Pr≈Ømƒõrn√© sk√≥re
            let totalScore = 0;
            finishedMatches.forEach(m => {
                totalScore += m.score1 + m.score2;
            });
            const avgScore = finishedMatches.length > 0 ? (totalScore / finishedMatches.length).toFixed(1) : 0;
            
            // Nejdel≈°√≠ s√©rie v√Ωher
            const streaks = {};
            participants.forEach(p => {
                streaks[p.id] = { current: 0, max: 0 };
            });
            
            finishedMatches.forEach(match => {
                if (match.score1 > match.score2) {
                    streaks[match.player1.id].current++;
                    streaks[match.player1.id].max = Math.max(streaks[match.player1.id].max, streaks[match.player1.id].current);
                    streaks[match.player2.id].current = 0;
                } else if (match.score2 > match.score1) {
                    streaks[match.player2.id].current++;
                    streaks[match.player2.id].max = Math.max(streaks[match.player2.id].max, streaks[match.player2.id].current);
                    streaks[match.player1.id].current = 0;
                }
            });
            
            const bestStreak = Object.entries(streaks).reduce((best, [id, streak]) => {
                return streak.max > best.max ? { id, max: streak.max } : best;
            }, { id: null, max: 0 });
            
            const bestStreakPlayer = participants.find(p => p.id == bestStreak.id);
            
            const content = document.getElementById('statsContent');
            content.innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Dokonƒçeno z√°pas≈Ø</div>
                        <div class="text-2xl font-bold">${finishedMatches.length} / ${totalMatches}</div>
                        <div class="text-sm text-gray-600">${progress}%</div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Pr≈Ømƒõrn√© sk√≥re z√°pasu</div>
                        <div class="text-2xl font-bold">${avgScore}</div>
                    </div>
                    
                    ${bestStreakPlayer ? `
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="text-sm text-gray-600">Nejdel≈°√≠ s√©rie v√Ωher</div>
                            <div class="text-2xl font-bold">${bestStreak.max}</div>
                            <div class="text-sm text-gray-600">${bestStreakPlayer.name}</div>
                        </div>
                    ` : ''}
                    
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Celkem √∫ƒçastn√≠k≈Ø</div>
                        <div class="text-2xl font-bold">${participants.length}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('statsModal').classList.remove('hidden');
        };
        
        window.closeStats = () => {
            document.getElementById('statsModal').classList.add('hidden');
        };
        
        // QR k√≥d
        window.showQRCode = () => {
            const data = JSON.stringify(window.tournamentData);
            const encodedData = btoa(encodeURIComponent(data));
            const url = window.location.href.split('?')[0] + '?data=' + encodedData;
            
            const container = document.getElementById('qrCodeContainer');
            container.innerHTML = `
                <div class="bg-gray-100 p-4 rounded-lg inline-block">
                    <div class="text-xs break-all mb-2">${url.substring(0, 50)}...</div>
                    <p class="text-sm text-gray-600 mt-2">Zkop√≠rujte URL pro sd√≠len√≠</p>
                    <button onclick="copyToClipboard('${url}')" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded-lg">
                        Zkop√≠rovat odkaz
                    </button>
                </div>
            `;
            
            document.getElementById('qrModal').classList.remove('hidden');
        };
        
        window.closeQR = () => {
            document.getElementById('qrModal').classList.add('hidden');
        };
        
        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Odkaz zkop√≠rov√°n!');
            });
        };
        
        // Duplikovat turnaj
        window.duplicateTournament = () => {
            if (!confirm('Vytvo≈ôit nov√Ω turnaj se stejn√Ωmi √∫ƒçastn√≠ky a nastaven√≠m?')) return;
            
            const newData = {
                name: window.tournamentData.name + ' (kopie)',
                system: window.tournamentData.system,
                numGroups: window.tournamentData.numGroups,
                playoffType: window.tournamentData.playoffType,
                pointSystem: window.tournamentData.pointSystem,
                participants: window.tournamentData.participants.map(p => ({
                    ...p,
                    wins: 0,
                    losses: 0,
                    setsWon: 0,
                    setsLost: 0,
                    points: 0
                })),
                matches: [],
                groups: [],
                playoffMatches: [],
                swissRound: 1,
                step: 'setup',
                history: []
            };
            
            Object.assign(window.tournamentData, newData);
            saveData();
            
            document.getElementById('matchesSection').classList.add('hidden');
            document.getElementById('playoffSection').classList.add('hidden');
            document.getElementById('setupSection').classList.remove('hidden');
            document.getElementById('tournamentName').value = newData.name;
            
            renderParticipants();
            showNotification('Turnaj duplikov√°n!');
        };
        
        // Naƒç√≠st data z URL (QR k√≥d)
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const decodedData = decodeURIComponent(atob(dataParam));
                    const data = JSON.parse(decodedData);
                    Object.assign(window.tournamentData, data);
                    saveData();
                    showNotification('Data naƒçtena z odkazu!');
                    
                    // Odstranit parametr z URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                    
                    // Zobrazit odpov√≠daj√≠c√≠ sekci
                    if (data.step === 'matches') {
                        document.getElementById('setupSection').classList.add('hidden');
                        document.getElementById('matchesSection').classList.remove('hidden');
                        renderParticipants();
                    }
                } catch (error) {
                    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat z URL:', error);
                }
            }
        });
    <!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Profesion√°ln√≠ spr√°va badmintonov√Ωch turnaj≈Ø - rozlosov√°n√≠, v√Ωsledky, statistiky">
    <meta name="theme-color" content="#3b82f6">
    <title>Rozlosov√°n√≠ turnaje - Badminton</title>
    
    <!-- PWA Support -->
    <link rel="manifest" href="./manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè∏</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè∏</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Badminton">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .hidden { display: none; }
        
        /* Dark mode */
        body.dark-mode {
            background: linear-gradient(to bottom right, #1a202c, #2d3748);
        }
        body.dark-mode .bg-white {
            background-color: #2d3748 !important;
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-800 {
            color: #e2e8f0 !important;
        }
        body.dark-mode .text-gray-700 {
            color: #cbd5e0 !important;
        }
        body.dark-mode .text-gray-600 {
            color: #a0aec0 !important;
        }
        body.dark-mode .bg-gray-50 {
            background-color: #374151 !important;
        }
        body.dark-mode input, body.dark-mode select {
            background-color: #374151;
            color: #e2e8f0;
            border-color: #4a5568;
        }
        
        /* Progress bar */
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: width 0.3s ease;
        }
        
        /* Win/Loss highlighting */
        .row-win {
            background-color: #dcfce7 !important;
        }
        .row-loss {
            background-color: #fee2e2 !important;
        }
        .row-draw {
            background-color: #fef3c7 !important;
        }
        body.dark-mode .row-win {
            background-color: #064e3b !important;
        }
        body.dark-mode .row-loss {
            background-color: #7f1d1d !important;
        }
        body.dark-mode .row-draw {
            background-color: #713f12 !important;
        }
        
        /* Highlighting pro pozice v tabulce */
        .position-gold {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%) !important;
        }
        .position-silver {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%) !important;
        }
        .position-bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #e8a87c 100%) !important;
        }
        
        /* Pr√°vƒõ hraje animace */
        .playing-now {
            background: linear-gradient(90deg, #fef3c7, #fde68a, #fef3c7) !important;
            background-size: 200% 100%;
            animation: playing-pulse 2s ease-in-out infinite;
            border-left: 4px solid #f59e0b !important;
        }
        
        @keyframes playing-pulse {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .playing-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #f59e0b;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            animation: badge-pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes badge-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Print styles */
        @media print {
            body {
                background: white !important;
            }
            .no-print {
                display: none !important;
            }
            .bg-gradient-to-r, .bg-gradient-to-br {
                background: white !important;
                color: black !important;
            }
            .bg-white {
                box-shadow: none !important;
            }
            .rounded-xl {
                border: 1px solid #e5e7eb;
            }
            input {
                border: none !important;
                background: transparent !important;
                text-align: center;
                font-weight: bold;
            }
            .progress-bar {
                display: none;
            }
            h1, h2, h3 {
                color: black !important;
            }
            /* Page break mezi skupinami */
            .page-break {
                page-break-before: always;
            }
            /* Lep≈°√≠ form√°tov√°n√≠ tabulek */
            table {
                page-break-inside: avoid;
            }
            .bg-blue-600 {
                background: #2563eb !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* QR Code modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }
        body.dark-mode .modal-content {
            background: #2d3748;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
    <div class="max-w-6xl mx-auto">
        <!-- Hlaviƒçka -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold flex items-center gap-3">
                        üè∏ Rozlosov√°n√≠ turnaje
                    </h1>
                    <p class="text-blue-100 mt-2">Badmintonov√© turnaje - profesion√°ln√≠ spr√°va</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleDarkMode()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-semibold transition-colors" title="P≈ôepnout tmav√Ω re≈æim">
                        üåô
                    </button>
                    <button onclick="showStats()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-semibold transition-colors">
                        üìä Statistiky
                    </button>
                    <button onclick="exportData()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-semibold transition-colors">
                        üì• Export
                    </button>
                    <label class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-semibold transition-colors cursor-pointer">
                        üì§ Import
                        <input type="file" accept=".json" onchange="importData(event)" class="hidden">
                    </label>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Bodov√Ω syst√©m</label>
                        <select id="pointSystem" 
                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="2">2 body za v√Ωhru, 1 za rem√≠zu, 0 za prohru</option>
                            <option value="3">3 body za v√Ωhru, 1 za rem√≠zu, 0 za prohru</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sekce nastaven√≠ -->
        <div id="setupSection" class="space-y-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">‚öôÔ∏è Nastaven√≠ turnaje</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">N√°zev turnaje</label>
                        <input type="text" id="tournamentName" 
                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                            placeholder="Nap≈ô. V√°noƒçn√≠ turnaj 2025">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Hern√≠ syst√©m</label>
                        <select id="systemSelect" onchange="changeSystem()" 
                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="roundrobin">Ka≈æd√Ω s ka≈æd√Ωm</option>
                            <option value="groups">Skupiny + Play-off</option>
                            <option value="swiss">≈†v√Ωcarsk√Ω syst√©m</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Bodov√Ω syst√©m</label>
                        <select id="pointSystem" 
                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="2">2 body za v√Ωhru, 1 za rem√≠zu, 0 za prohru</option>
                            <option value="3">3 body za v√Ωhru, 1 za rem√≠zu, 0 za prohru</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Pravidla tie-breaku (p≈ôi shodƒõ bod≈Ø)</label>
                        <select id="tieBreakRules" 
                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="wins-sets-direct">1. Poƒçet v√Ωher ‚Üí 2. Sk√≥re set≈Ø ‚Üí 3. Vz√°jemn√Ω z√°pas</option>
                            <option value="wins-direct-sets">1. Poƒçet v√Ωher ‚Üí 2. Vz√°jemn√Ω z√°pas ‚Üí 3. Sk√≥re set≈Ø</option>
                            <option value="sets-wins-direct">1. Sk√≥re set≈Ø ‚Üí 2. Poƒçet v√Ωher ‚Üí 3. Vz√°jemn√Ω z√°pas</option>
                            <option value="direct-wins-sets">1. Vz√°jemn√Ω z√°pas ‚Üí 2. Poƒçet v√Ωher ‚Üí 3. Sk√≥re set≈Ø</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Urƒçuje po≈ôad√≠ p≈ôi stejn√©m poƒçtu bod≈Ø v tabulce</p>
                    </div>

                    <!-- Nastaven√≠ pro skupiny -->
                    <div id="groupSettings" class="hidden space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Poƒçet skupin</label>
                            <input type="number" id="numGroups" value="2" min="2" max="4"
                                class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Typ play-off</label>
                            <select id="playoffType" 
                                class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                <option value="winners">Pouze v√≠tƒõzov√© skupin (fin√°le, o 3. m√≠sto...)</option>
                                <option value="half">Horn√≠ p≈Ølka vs spodn√≠ p≈Ølka</option>
                                <option value="full">Celkov√Ω pavouk v≈°ech √∫ƒçastn√≠k≈Ø</option>
                            </select>
                        </div>
                    </div>

                    <!-- Info o ≈°v√Ωcarsk√©m syst√©mu -->
                    <div id="swissInfo" class="hidden bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <strong>≈†v√Ωcarsk√Ω syst√©m:</strong> Po ka≈æd√©m kole se hr√°ƒçi p√°ruj√≠ podle aktu√°ln√≠ho po≈ôad√≠. 
                            Poƒçet kol se vypoƒç√≠t√° automaticky podle poƒçtu √∫ƒçastn√≠k≈Ø.
                        </p>
                    </div>
                </div>
            </div>

            <!-- √öƒçastn√≠ci -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    üë• √öƒçastn√≠ci (<span id="participantCount">0</span>)
                </h2>

                <div class="flex gap-2 mb-4">
                    <input type="text" id="newParticipant" 
                        class="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                        placeholder="Jm√©no √∫ƒçastn√≠ka"
                        onkeypress="if(event.key==='Enter') addParticipant()">
                    <button onclick="addParticipant()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition-colors">
                        P≈ôidat
                    </button>
                </div>

                <div id="participantsList" class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-4">
                </div>

                <button onclick="startTournament()" id="startButton"
                    class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition-colors hidden">
                    ‚ñ∂Ô∏è Spustit turnaj
                </button>
            </div>
        </div>

        <!-- Sekce z√°pas≈Ø -->
        <div id="matchesSection" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800" id="tournamentTitle"></h2>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="showSearch()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            üîç Hledat
                        </button>
                        <button onclick="editRounds()" id="editRoundsBtn" class="hidden bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            ‚úèÔ∏è Upravit kola
                        </button>
                        <button onclick="generateNextRound()" id="nextRoundBtn" class="hidden bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            Dal≈°√≠ kolo
                        </button>
                        <button onclick="generatePlayoff()" id="playoffBtn" class="hidden bg-purple-600 hover:bg-purple-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            Generovat Play-off
                        </button>
                        <button onclick="duplicateTournament()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            üìã Duplikovat
                        </button>
                        <button onclick="window.print()" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            üñ®Ô∏è Tisk
                        </button>
                        <button onclick="exportToPDF()" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            üìÑ PDF
                        </button>
                        <button onclick="showQRCode()" class="bg-orange-600 hover:bg-orange-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            üì± QR
                        </button>
                        <button onclick="exportData()" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            üì•
                        </button>
                        <button onclick="resetTournament()" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg no-print">
                            Reset
                        </button>
                    </div>
                </div>
                
                <!-- Progress bar -->
                <div id="progressBar" class="mb-4">
                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                        <span>Pr≈Øbƒõh turnaje</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Obsah podle syst√©mu -->
            <div id="matchesContent"></div>
        </div>

        <!-- Sekce play-off -->
        <div id="playoffSection" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">üèÜ Play-off</h2>
                    <div class="flex gap-2">
                        <button onclick="backToGroups()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold px-4 py-2 rounded-lg">
                            ‚Üê Zpƒõt na skupiny
                        </button>
                        <button onclick="exportData()" class="bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-lg">
                            üì• Export
                        </button>
                        <button onclick="resetTournament()" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg">
                            Reset
                        </button>
                    </div>
                </div>
            </div>
            <div id="playoffContent"></div>
        </div>

        <!-- Modal pro vyhled√°v√°n√≠ -->
        <div id="searchModal" class="modal hidden" onclick="if(event.target === this) closeSearch()">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">üîç Vyhledat hr√°ƒçe/z√°pas</h3>
                    <button onclick="closeSearch()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <input type="text" id="searchInput" oninput="performSearch()" 
                    class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none mb-4"
                    placeholder="Zadejte jm√©no hr√°ƒçe...">
                <div id="searchResults" class="max-h-96 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Modal pro statistiky -->
        <div id="statsModal" class="modal hidden" onclick="if(event.target === this) closeStats()">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">üìä Detailn√≠ statistiky</h3>
                    <button onclick="closeStats()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="statsContent"></div>
            </div>
        </div>

        <!-- Modal pro historii -->
        <div id="historyModal" class="modal hidden" onclick="if(event.target === this) closeHistory()">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">üìú Historie zmƒõn</h3>
                    <button onclick="closeHistory()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="historyContent" class="max-h-96 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Modal pro √∫pravu kol -->
        <div id="editRoundsModal" class="modal hidden" onclick="if(event.target === this) closeEditRounds()">
            <div class="modal-content max-w-3xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">‚úèÔ∏è Upravit rozlosov√°n√≠ kol</h3>
                    <button onclick="closeEditRounds()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="editRoundsContent" class="max-h-96 overflow-y-auto"></div>
                <div class="mt-4 flex justify-end gap-2">
                    <button onclick="closeEditRounds()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                        Zru≈°it
                    </button>
                    <button onclick="saveRoundEdits()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        üíæ Ulo≈æit zmƒõny
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal pro QR k√≥d -->
        <div id="qrModal" class="modal hidden" onclick="if(event.target === this) closeQR()">
            <div class="modal-content text-center">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">üì± QR k√≥d pro sd√≠len√≠</h3>
                    <button onclick="closeQR()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="qrCodeContainer" class="mb-4"></div>
                <p class="text-sm text-gray-600">Naskenujte QR k√≥d pro import dat</p>
            </div>
        </div>

        <!-- Notifikace -->
        <div id="notificationContainer"></div>
        
        <!-- PWA Install prompt -->
        <div id="pwaInstallPrompt" class="hidden fixed bottom-4 right-4 bg-white rounded-lg shadow-2xl p-4 max-w-sm z-50 border-2 border-blue-500">
            <div class="flex items-start gap-3">
                <div class="text-4xl">üì±</div>
                <div class="flex-1">
                    <h4 class="font-bold text-gray-800 mb-1">Instalovat aplikaci?</h4>
                    <p class="text-sm text-gray-600 mb-3">P≈ôidejte si Badminton Turnaje na plochu pro rychl√Ω p≈ô√≠stup!</p>
                    <div class="flex gap-2">
                        <button onclick="installPWA()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold text-sm">
                            Instalovat
                        </button>
                        <button onclick="dismissPWAPrompt()" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded font-semibold text-sm">
                            Pozdƒõji
                        </button>
                    </div>
                </div>
                <button onclick="dismissPWAPrompt()" class="text-gray-400 hover:text-gray-600">‚úï</button>
            </div>
        </div>
    </div>

    <!-- PWA Registration Script -->
    <script>
        // Service Worker registrace
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrov√°n:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registrace selhala:', error);
                    });
            });
        }
        
        // PWA Install prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Zobrazit install prompt po 3 sekund√°ch (pokud u≈æ nebyl zam√≠tnut)
            if (!localStorage.getItem('pwaPromptDismissed')) {
                setTimeout(() => {
                    document.getElementById('pwaInstallPrompt').classList.remove('hidden');
                }, 3000);
            }
        });
        
        window.installPWA = async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('‚úÖ PWA instalov√°na');
            }
            
            deferredPrompt = null;
            document.getElementById('pwaInstallPrompt').classList.add('hidden');
        };
        
        window.dismissPWAPrompt = () => {
            document.getElementById('pwaInstallPrompt').classList.add('hidden');
            localStorage.setItem('pwaPromptDismissed', 'true');
        };
        
        // Detekce standalone m√≥du
        window.addEventListener('DOMContentLoaded', () => {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches 
                || window.navigator.standalone 
                || document.referrer.includes('android-app://');
            
            if (isStandalone) {
                console.log('‚úÖ Aplikace bƒõ≈æ√≠ v standalone m√≥du');
            }
        });
    </script>

    <!-- Moduly -->
    <script type="module" src="./modules/storage.js"></script>
    <script type="module" src="./modules/setup.js"></script>
    <script type="module" src="./modules/roundrobin.js"></script>
    <script type="module" src="./modules/groups.js"></script>
    <script type="module" src="./modules/swiss.js"></script>
    <script type="module" src="./modules/playoff.js"></script>
    <script type="module" src="./modules/utils.js"></script>

    <script type="module">
        // Glob√°ln√≠ data
        window.tournamentData = {
            name: '',
            system: 'roundrobin',
            numGroups: 2,
            playoffType: 'winners',
            pointSystem: 2,
            tieBreakRules: 'wins-sets-direct',
            participants: [],
            matches: [],
            groups: [],
            playoffMatches: [],
            swissRound: 1,
            step: 'setup',
            history: []
        };

        // Import modul≈Ø
        import { loadData, saveData, exportToFile, importFromFile } from './modules/storage.js';
        import { renderParticipants, addParticipant as addP, removeParticipant } from './modules/setup.js';
        import { generateRoundRobin, renderRoundRobin } from './modules/roundrobin.js';
        import { generateGroups, renderGroups } from './modules/groups.js';
        import { generateSwiss, renderSwiss, nextSwissRound } from './modules/swiss.js';
        import { generatePlayoffMatches, renderPlayoff } from './modules/playoff.js';

        // Dark mode
        window.toggleDarkMode = () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
        };
        
        // Export do PDF (jednoduch√° verze - pou≈æ√≠v√° print dialog)
        window.exportToPDF = () => {
            // P≈ôidat speci√°ln√≠ t≈ô√≠du pro PDF export
            document.body.classList.add('pdf-export');
            
            // Nastavit titulek dokumentu
            const originalTitle = document.title;
            document.title = window.tournamentData.name || 'Turnaj';
            
            // Spustit tisk
            window.print();
            
            // Obnovit
            document.title = originalTitle;
            document.body.classList.remove('pdf-export');
        };
        
        // Vyhled√°v√°n√≠
        window.showSearch = () => {
            document.getElementById('searchModal').classList.remove('hidden');
            document.getElementById('searchInput').focus();
        };
        
        window.closeSearch = () => {
            document.getElementById('searchModal').classList.add('hidden');
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
        };
        
        window.performSearch = () => {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const results = document.getElementById('searchResults');
            
            if (!query) {
                results.innerHTML = '';
                return;
            }
            
            const system = window.tournamentData.system;
            let allMatches = [];
            
            // Sb√≠rat z√°pasy podle syst√©mu
            if (system === 'groups') {
                window.tournamentData.groups.forEach(group => {
                    group.matches.forEach(match => {
                        if (match.player1.name.toLowerCase().includes(query) || 
                            match.player2.name.toLowerCase().includes(query)) {
                            allMatches.push({...match, groupName: group.name});
                        }
                    });
                });
            } else {
                allMatches = window.tournamentData.matches.filter(match => 
                    match.player1.name.toLowerCase().includes(query) || 
                    match.player2.name.toLowerCase().includes(query)
                );
            }
            
            if (allMatches.length === 0) {
                results.innerHTML = '<p class="text-gray-500 text-center py-4">≈Ω√°dn√© v√Ωsledky</p>';
                return;
            }
            
            results.innerHTML = allMatches.map(match => `
                <div class="bg-gray-50 p-3 rounded-lg mb-2">
                    ${match.groupName ? `<div class="text-xs text-gray-500 mb-1">${match.groupName}</div>` : ''}
                    ${match.round ? `<div class="text-xs text-gray-500 mb-1">Kolo ${match.round}</div>` : ''}
                    <div class="flex items-center justify-between">
                        <span class="font-medium ${match.player1.name.toLowerCase().includes(query) ? 'text-blue-600' : ''}">${match.player1.name}</span>
                        <span class="font-bold ${match.finished ? 'text-green-600' : 'text-gray-400'}">${match.finished ? `${match.score1}:${match.score2}` : 'vs'}</span>
                        <span class="font-medium ${match.player2.name.toLowerCase().includes(query) ? 'text-blue-600' : ''}">${match.player2.name}</span>
                    </div>
                    ${match.note ? `<div class="text-xs text-gray-600 italic mt-1">üìù ${match.note}</div>` : ''}
                </div>
            `).join('');
        };
        
        // P≈ôidat pozn√°mku k z√°pasu
        window.addMatchNote = (matchId, groupId = null) => {
            let match;
            
            if (groupId !== null) {
                const group = window.tournamentData.groups.find(g => g.id === groupId);
                match = group?.matches.find(m => m.id === matchId);
            } else {
                match = window.tournamentData.matches.find(m => m.id === matchId);
            }
            
            const currentNote = match?.note || '';
            const note = prompt('Zadejte pozn√°mku k z√°pasu (nap≈ô. kontumace, zranƒõn√≠):', currentNote);
            
            if (note === null) return; // U≈æivatel zru≈°il
            
            if (groupId !== null) {
                window.tournamentData.groups = window.tournamentData.groups.map(g => {
                    if (g.id === groupId) {
                        return {
                            ...g,
                            matches: g.matches.map(m => {
                                if (m.id === matchId) {
                                    return { ...m, note: note.trim() };
                                }
                                return m;
                            })
                        };
                    }
                    return g;
                });
                saveData();
                renderGroups();
            } else {
                window.tournamentData.matches = window.tournamentData.matches.map(m => {
                    if (m.id === matchId) {
                        return { ...m, note: note.trim() };
                    }
                    return m;
                });
                saveData();
                
                // Re-render podle syst√©mu
                if (window.tournamentData.system === 'roundrobin') {
                    renderRoundRobin();
                } else if (window.tournamentData.system === 'swiss') {
                    renderSwiss();
                }
            }
            
            if (note.trim()) {
                showNotification('üìù Pozn√°mka p≈ôid√°na', 'success');
            } else {
                showNotification('üóëÔ∏è Pozn√°mka smaz√°na', 'warning');
            }
        };
        
        // Naƒçten√≠ dat p≈ôi startu
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderParticipants();
            changeSystem();
            
            // Naƒç√≠st dark mode z localStorage
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        });

        // Zmƒõna syst√©mu
        window.changeSystem = () => {
            const system = document.getElementById('systemSelect').value;
            window.tournamentData.system = system;
            
            document.getElementById('groupSettings').classList.toggle('hidden', system !== 'groups');
            document.getElementById('swissInfo').classList.toggle('hidden', system !== 'swiss');
            saveData();
        };

        // P≈ôidat √∫ƒçastn√≠ka
        window.addParticipant = () => {
            addP();
            const lastParticipant = window.tournamentData.participants[window.tournamentData.participants.length - 1];
            if (lastParticipant) {
                addToHistory('participant_add', { name: lastParticipant.name });
            }
            renderParticipants();
        };

        // Odstranit √∫ƒçastn√≠ka
        window.removeParticipant = (id) => {
            const participant = window.tournamentData.participants.find(p => p.id === id);
            removeParticipant(id);
            if (participant) {
                addToHistory('participant_remove', { name: participant.name });
            }
            renderParticipants();
        };

        // Spustit turnaj
        window.startTournament = () => {
            const name = document.getElementById('tournamentName').value.trim();
            const participants = window.tournamentData.participants;

            if (!name) {
                showNotification('‚ùå Zadejte n√°zev turnaje!', 'error');
                return;
            }

            if (participants.length < 2) {
                showNotification('‚ùå P≈ôidejte alespo≈à 2 √∫ƒçastn√≠ky!', 'error');
                return;
            }

            window.tournamentData.name = name;
            window.tournamentData.step = 'matches';
            window.tournamentData.pointSystem = parseInt(document.getElementById('pointSystem').value);
            window.tournamentData.tieBreakRules = document.getElementById('tieBreakRules').value;

            const system = window.tournamentData.system;

            if (system === 'roundrobin') {
                generateRoundRobin();
                renderRoundRobin();
                addToHistory('tournament_start', { system: 'Ka≈æd√Ω s ka≈æd√Ωm', participants: participants.length });
                showNotification(`‚úÖ Turnaj "${name}" spu≈°tƒõn!`, 'success');
            } else if (system === 'groups') {
                const numGroups = parseInt(document.getElementById('numGroups').value);
                window.tournamentData.numGroups = numGroups;
                window.tournamentData.playoffType = document.getElementById('playoffType').value;
                generateGroups(numGroups);
                renderGroups();
                addToHistory('tournament_start', { system: 'Skupiny', numGroups: numGroups, participants: participants.length });
                showNotification(`‚úÖ Skupiny vygenerov√°ny! ${numGroups} skupiny`, 'success');
            } else if (system === 'swiss') {
                generateSwiss();
                renderSwiss();
                addToHistory('tournament_start', { system: '≈†v√Ωcarsk√Ω syst√©m', participants: participants.length });
                showNotification(`‚úÖ ≈†v√Ωcarsk√Ω syst√©m spu≈°tƒõn!`, 'success');
            }

            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('matchesSection').classList.remove('hidden');
            document.getElementById('tournamentTitle').textContent = name;

            saveData();
        };

        // Generovat dal≈°√≠ kolo (≈°v√Ωcar)
        window.generateNextRound = () => {
            if (window.tournamentData.system === 'swiss') {
                nextSwissRound();
                renderSwiss();
            }
        };

        // Generovat play-off
        window.generatePlayoff = () => {
            generatePlayoffMatches();
            addToHistory('playoff_generate', { type: window.tournamentData.playoffType });
            document.getElementById('matchesSection').classList.add('hidden');
            document.getElementById('playoffSection').classList.remove('hidden');
            renderPlayoff();
        };

        // Zpƒõt na skupiny
        window.backToGroups = () => {
            document.getElementById('playoffSection').classList.add('hidden');
            document.getElementById('matchesSection').classList.remove('hidden');
        };

        // Reset turnaje
        window.resetTournament = () => {
            if (!confirm('Opravdu chcete resetovat cel√Ω turnaj?')) return;

            window.tournamentData.step = 'setup';
            window.tournamentData.matches = [];
            window.tournamentData.groups = [];
            window.tournamentData.playoffMatches = [];
            window.tournamentData.swissRound = 1;

            // Reset stats √∫ƒçastn√≠k≈Ø
            window.tournamentData.participants = window.tournamentData.participants.map(p => ({
                ...p,
                wins: 0,
                losses: 0,
                setsWon: 0,
                setsLost: 0,
                points: 0
            }));

            document.getElementById('setupSection').classList.remove('hidden');
            document.getElementById('matchesSection').classList.add('hidden');
            document.getElementById('playoffSection').classList.add('hidden');

            saveData();
            renderParticipants();
            addToHistory('tournament_reset', {});
            showNotification('üîÑ Turnaj resetov√°n', 'warning');
        };

        // Export dat
        window.exportData = () => {
            exportToFile();
            addToHistory('data_export', {});
        };

        // Import dat
        window.importData = (event) => {
            importFromFile(event, () => {
                addToHistory('data_import', {});
                renderParticipants();
                changeSystem();
                
                if (window.tournamentData.step === 'matches') {
                    document.getElementById('setupSection').classList.add('hidden');
                    document.getElementById('matchesSection').classList.remove('hidden');
                    document.getElementById('tournamentTitle').textContent = window.tournamentData.name;
                    
                    const system = window.tournamentData.system;
                    if (system === 'roundrobin') renderRoundRobin();
                    else if (system === 'groups') renderGroups();
                    else if (system === 'swiss') renderSwiss();
                } else if (window.tournamentData.step === 'playoff') {
                    document.getElementById('setupSection').classList.add('hidden');
                    document.getElementById('playoffSection').classList.remove('hidden');
                    renderPlayoff();
                }
            });
        };
    </script>
</body>
</html>